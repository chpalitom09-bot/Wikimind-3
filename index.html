<!DOCTYPE html>
<html lang="fr" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>WikiMind OS ‚Ä¢ Intelligence Cognitive</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&family=Space+Grotesk:wght@300;500;700&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: { sans: ['Inter', 'sans-serif'], display: ['Space Grotesk', 'sans-serif'] },
                    colors: {
                        glass: { panel: 'rgba(20, 20, 20, 0.6)', border: 'rgba(255, 255, 255, 0.08)' },
                        brand: { 500: '#6366f1', 600: '#4f46e5', glow: '#818cf8' }
                    },
                    animation: { 'fade-in-up': 'fadeInUp 0.5s ease-out forwards' },
                    keyframes: { fadeInUp: { '0%': { opacity: 0, transform: 'translateY(10px)' }, '100%': { opacity: 1, transform: 'translateY(0)' } } }
                }
            }
        }
    </script>
    <style>
        body { background-color: #050505; color: #ffffff; overflow-x: hidden; }
        .glass-panel {
            background: rgba(20, 20, 20, 0.6); backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.08); box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.3);
        }
        .text-gradient { background: linear-gradient(135deg, #ffffff 0%, #a5a6f6 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        
        /* Recherche */
        .search-active .module-card { opacity: 0.3; filter: blur(2px); transition: all 0.3s; }
        .search-active .module-card.match { opacity: 1; filter: blur(0); border-color: #6366f1; transform: scale(1.02); }
        
        /* Commentaires */
        .comment-thread { border-left: 2px solid rgba(255,255,255,0.05); margin-left: 1.5rem; padding-left: 1rem; }
        .like-anim { animation: heartPop 0.3s ease-out; }
        @keyframes heartPop { 0% { transform: scale(1); } 50% { transform: scale(1.3); } 100% { transform: scale(1); } }
    </style>
</head>
<body class="selection:bg-brand-500 selection:text-white">

    <!-- AURORA BG -->
    <canvas id="aurora-bg" class="fixed top-0 left-0 w-full h-full -z-10"></canvas>

    <!-- NAVBAR -->
    <nav class="fixed top-0 w-full z-50 px-6 py-6 transition-all duration-300" id="navbar">
        <div class="max-w-7xl mx-auto flex justify-between items-center glass-panel rounded-full px-6 py-3">
            <a href="#" class="flex items-center gap-3 group">
                <div class="w-8 h-8 bg-gradient-to-tr from-white to-gray-400 rounded-lg flex items-center justify-center">
                    <span class="font-bold text-black text-xs">W</span>
                </div>
                <span class="font-display font-bold text-lg tracking-tight">WikiMind <span class="text-white/40 font-normal">3.0</span></span>
            </a>

            <!-- Search Bar -->
            <div class="hidden md:flex flex-1 max-w-md mx-8 relative group">
                <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                    <i class="fa-solid fa-search text-white/40"></i>
                </div>
                <input type="text" id="app-search" placeholder="Rechercher (Core, Studio, Academy...)" 
                       class="block w-full pl-10 pr-3 py-1.5 border border-white/10 rounded-full leading-5 bg-white/5 text-white placeholder-white/30 focus:outline-none focus:bg-white/10 focus:border-brand-500 sm:text-sm transition-all">
            </div>

            <!-- Auth State -->
            <div id="auth-container" class="flex items-center gap-4">
                <!-- √âtat d√©connect√© -->
                <a href="Wikimind_user.html" id="login-btn" class="px-5 py-2 rounded-full bg-white text-black font-bold text-xs uppercase tracking-wider hover:bg-gray-200 transition-colors">
                    Connexion
                </a>
                <!-- √âtat connect√© -->
                <div id="user-logged" class="hidden flex items-center gap-3">
                    <div class="text-right hidden md:block">
                        <div id="user-name-display" class="text-xs font-bold text-white">Utilisateur</div>
                        <div class="text-[10px] text-green-400">‚óè En ligne</div>
                    </div>
                    <a href="Wikimind_user.html" class="relative group">
                        <img id="nav-avatar" src="" class="w-9 h-9 rounded-full border border-white/20 object-cover bg-gray-800">
                        <div class="absolute inset-0 rounded-full border border-brand-500 opacity-0 group-hover:opacity-100 transition-opacity"></div>
                    </a>
                </div>
            </div>
        </div>
    </nav>

    <main class="relative pt-32 pb-20 px-4 md:px-6">
        
        <!-- HERO -->
        <section class="max-w-7xl mx-auto text-center min-h-[60vh] flex flex-col justify-center items-center">
            <div class="inline-flex items-center gap-2 px-3 py-1 rounded-full border border-brand-500/30 bg-brand-500/10 text-brand-glow text-[10px] uppercase font-bold tracking-[0.2em] mb-8 animate-fade-in-up">
                <span class="w-1.5 h-1.5 rounded-full bg-green-400 animate-pulse"></span>
                R√©seau de Neurones Unifi√©
            </div>

            <h1 class="text-5xl md:text-8xl font-display font-bold leading-tight mb-8 tracking-tighter animate-fade-in-up" style="animation-delay: 0.1s;">
                L'orchestration<br>
                <span class="text-gradient">cognitive.</span>
            </h1>

            <p class="text-lg md:text-xl text-white/60 max-w-2xl mx-auto mb-12 font-light leading-relaxed animate-fade-in-up" style="animation-delay: 0.2s;">
                WikiMind 3.0 n'est pas un outil, c'est une extension de votre conscience. 
                <br><span class="text-xs text-white/40 mt-2 block">üîí Donn√©es crypt√©es. 0% partag√© avec des tiers.</span>
            </p>

            <div class="flex flex-col md:flex-row items-center gap-4 animate-fade-in-up" style="animation-delay: 0.3s;">
                <a href="#ecosystem" class="px-8 py-4 rounded-xl bg-white/10 backdrop-blur-md border border-white/20 text-white font-display font-bold text-sm uppercase tracking-wider hover:bg-white/20 transition-all">
                    Explorer les Modules
                </a>
            </div>
        </section>

        <!-- APPS GRID -->
        <section id="ecosystem" class="max-w-7xl mx-auto py-24 border-t border-white/5">
            <div class="flex justify-between items-end mb-12">
                <h2 class="text-3xl font-display font-bold">Modules Actifs</h2>
                <span class="text-white/40 text-xs uppercase tracking-widest">v3.0.4 stable</span>
            </div>
            
            <div class="bento-grid grid grid-cols-1 md:grid-cols-3 gap-6 auto-rows-[250px]" id="modules-container">
                <!-- Cards (identiques √† avant pour la structure) -->
                <div class="module-card md:col-span-2 glass-panel rounded-3xl p-8 relative overflow-hidden group cursor-pointer hover:border-brand-500/50 transition-all duration-300" data-name="wikimind core chat ai">
                    <div class="absolute top-0 right-0 p-32 bg-brand-500/10 blur-[80px] rounded-full group-hover:bg-brand-500/20 transition-all"></div>
                    <div class="relative z-10 h-full flex flex-col justify-between">
                        <div>
                            <div class="w-10 h-10 rounded-lg bg-white/10 flex items-center justify-center text-xl mb-4">üß†</div>
                            <h3 class="text-2xl font-display font-bold mb-2">WikiMind Core</h3>
                            <p class="text-white/60 max-w-md text-sm">LLM Fusionn√© (Llama + GPT-Optimized). Analyse locale.</p>
                        </div>
                    </div>
                </div>

                <div class="module-card glass-panel rounded-3xl p-6 relative overflow-hidden group cursor-pointer hover:border-brand-500/50 transition-all" data-name="studio creative image video">
                    <div class="w-10 h-10 rounded-lg bg-white/10 flex items-center justify-center text-xl mb-4">üé®</div>
                    <h3 class="text-xl font-display font-bold mb-1">Studio</h3>
                    <p class="text-white/60 text-xs">G√©n√©ration Visuelle.</p>
                </div>

                <div class="module-card glass-panel rounded-3xl p-6 group cursor-pointer hover:border-brand-500/50 transition-all" data-name="academy education math">
                    <div class="w-10 h-10 rounded-lg bg-white/10 flex items-center justify-center text-xl mb-4">üéì</div>
                    <h3 class="text-xl font-display font-bold mb-1">Academy</h3>
                    <p class="text-white/60 text-xs">Solveur Universitaire.</p>
                </div>

                <div class="module-card md:col-span-2 glass-panel rounded-3xl p-6 flex items-center justify-between group cursor-pointer hover:border-brand-500/50 transition-all" data-name="focus flow productivity">
                    <div class="flex items-center gap-4">
                        <div class="w-10 h-10 rounded-lg bg-white/10 flex items-center justify-center text-xl">‚ö°</div>
                        <div>
                            <h3 class="text-xl font-display font-bold">Focus Flow</h3>
                            <p class="text-white/60 text-xs">Productivit√© neuronale.</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- NOUVEL ESPACE COMMUNAUTAIRE -->
        <section id="comments-section" class="max-w-4xl mx-auto py-16">
            <div class="glass-panel rounded-3xl p-1 md:p-8 border border-white/10">
                
                <!-- En-t√™te -->
                <div class="px-6 py-4 border-b border-white/5 flex justify-between items-center">
                    <div>
                        <h2 class="text-2xl font-display font-bold">Espace Neuronal</h2>
                        <p class="text-white/40 text-xs mt-1">√âchangez avec le r√©seau en temps r√©el.</p>
                    </div>
                    <div class="text-xs bg-white/5 px-3 py-1 rounded-full text-white/60">
                        <i class="fa-solid fa-users mr-2"></i>Communaut√©
                    </div>
                </div>

                <!-- Zone de saisie principale (Visible si connect√©) -->
                <div id="main-comment-form-container" class="p-6 hidden">
                    <div class="flex gap-4">
                        <img id="current-user-avatar" src="" class="w-10 h-10 rounded-full border border-white/20 object-cover bg-gray-800">
                        <div class="flex-1">
                            <textarea id="main-comment-input" rows="2" placeholder="Partagez votre pens√©e..." 
                                class="w-full bg-white/5 border border-white/10 rounded-xl p-3 text-sm text-white focus:outline-none focus:border-brand-500 focus:bg-white/10 transition-all resize-none"></textarea>
                            <div class="flex justify-end mt-2">
                                <button id="submit-main-comment" class="bg-brand-600 hover:bg-brand-500 text-white px-5 py-2 rounded-lg text-xs font-bold uppercase tracking-wide transition-all shadow-lg shadow-brand-500/20">
                                    Publier
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Message si non connect√© -->
                <div id="login-prompt" class="p-8 text-center bg-white/[0.02] m-6 rounded-xl border border-dashed border-white/10">
                    <p class="text-white/60 mb-3 text-sm">Connectez-vous pour rejoindre le flux neuronal.</p>
                    <a href="Wikimind_user.html" class="inline-block px-6 py-2 bg-white text-black rounded-full text-xs font-bold hover:bg-gray-200 transition-colors">
                        Se connecter
                    </a>
                </div>

                <!-- Liste des commentaires -->
                <div id="comments-list" class="flex flex-col gap-0 p-2 md:p-4">
                    <!-- Loader -->
                    <div class="text-center py-8 text-white/20 animate-pulse">
                        Chargement du flux...
                    </div>
                </div>
            </div>
        </section>

    </main>

    <!-- FIREBASE LOGIC -->
    <script type="module">
        // UNIFICATION VERSION 10.8.0
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";
        import { getDatabase, ref, push, onChildAdded, onChildRemoved, onChildChanged, set, remove, runTransaction, get } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-database.js";

        // CONFIG 1 : AUTHENTIFICATION (Identique √† Wikimind_user.html)
        const authConfig = {
            apiKey: "AIzaSyD6qIOtKSx0Sl1Ht_a6ppLiMdKZRCc75tA",
            authDomain: "wikimind-3-comments.firebaseapp.com",
            projectId: "wikimind-3-comments",
            appId: "1:137479541640:web:4ed2510a9908055052e03d"
        };
        const authApp = initializeApp(authConfig, "authApp");
        const auth = getAuth(authApp);

        // CONFIG 2 : DATABASE COMMUNAUT√â
        const communityConfig = {
            apiKey: "AIzaSyCn5IyWS4deyVRG7zYY2qLQiNE49aD8a-Y",
            databaseURL: "https://wikimind-communauty-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "wikimind-communauty",
            appId: "1:842497095525:web:2b1c33ca7f4912b34dd38c"
        };
        const communityApp = initializeApp(communityConfig, "communityApp");
        const db = getDatabase(communityApp);

        // --- √âTAT UTILISATEUR ---
        let currentUser = null;

        // √âl√©ments DOM
        const loginBtn = document.getElementById('login-btn');
        const userLogged = document.getElementById('user-logged');
        const navAvatar = document.getElementById('nav-avatar');
        const userNameDisplay = document.getElementById('user-name-display');
        
        const mainFormContainer = document.getElementById('main-comment-form-container');
        const loginPrompt = document.getElementById('login-prompt');
        const currentUserAvatar = document.getElementById('current-user-avatar');
        const commentsList = document.getElementById('comments-list');

        // 1. D√©tection Connexion
        onAuthStateChanged(auth, (user) => {
            if (user) {
                console.log("Connect√© en tant que :", user.email);
                currentUser = user;
                
                // UI Navbar
                loginBtn.classList.add('hidden');
                userLogged.classList.remove('hidden');
                userLogged.classList.add('flex');
                
                const photoUrl = user.photoURL || `https://ui-avatars.com/api/?name=${user.email}&background=6366f1&color=fff&bold=true`;
                navAvatar.src = photoUrl;
                userNameDisplay.innerText = user.displayName || user.email.split('@')[0];

                // UI Commentaires
                mainFormContainer.classList.remove('hidden');
                loginPrompt.classList.add('hidden');
                currentUserAvatar.src = photoUrl;
                
            } else {
                console.log("D√©connect√©");
                currentUser = null;
                
                // UI Navbar
                loginBtn.classList.remove('hidden');
                userLogged.classList.add('hidden');
                userLogged.classList.remove('flex');

                // UI Commentaires
                mainFormContainer.classList.add('hidden');
                loginPrompt.classList.remove('hidden');
            }
        });

        // 2. Fonctions Utilitaires Date
        function timeAgo(timestamp) {
            const seconds = Math.floor((new Date() - timestamp) / 1000);
            let interval = seconds / 31536000;
            if (interval > 1) return Math.floor(interval) + " an(s)";
            interval = seconds / 2592000;
            if (interval > 1) return Math.floor(interval) + " mois";
            interval = seconds / 86400;
            if (interval > 1) return Math.floor(interval) + "j";
            interval = seconds / 3600;
            if (interval > 1) return Math.floor(interval) + "h";
            interval = seconds / 60;
            if (interval > 1) return Math.floor(interval) + " min";
            return "√† l'instant";
        }

        // 3. Gestion des Commentaires (CRUD)

        // CREATE (Root)
        document.getElementById('submit-main-comment').addEventListener('click', () => {
            const input = document.getElementById('main-comment-input');
            const text = input.value.trim();
            if (!text || !currentUser) return;

            const newPostRef = push(ref(db, 'comments'));
            set(newPostRef, {
                uid: currentUser.uid,
                author: currentUser.displayName || currentUser.email.split('@')[0],
                avatar: currentUser.photoURL || null,
                text: text,
                timestamp: Date.now(),
                likes: 0,
                replies: {} // Structure pour les r√©ponses
            });

            input.value = '';
        });

        // READ (Listen to added comments)
        const commentsRef = ref(db, 'comments');
        // Vider le loader au premier chargement si vide
        get(commentsRef).then(snapshot => {
            if(!snapshot.exists()) commentsList.innerHTML = '<div class="text-center text-white/30 py-4 text-sm">Soyez le premier √† publier.</div>';
            else if(commentsList.innerHTML.includes('Chargement')) commentsList.innerHTML = '';
        });

        onChildAdded(commentsRef, (snapshot) => {
            const data = snapshot.val();
            const id = snapshot.key;
            renderComment(id, data);
        });

        onChildRemoved(commentsRef, (snapshot) => {
            const el = document.getElementById(`comment-${snapshot.key}`);
            if (el) el.remove();
        });

        onChildChanged(commentsRef, (snapshot) => {
            const data = snapshot.val();
            const likeCountEl = document.querySelector(`#comment-${snapshot.key} .like-count`);
            if (likeCountEl) likeCountEl.innerText = data.likes || 0;
        });

        // FONCTION DE RENDU D'UN COMMENTAIRE
        function renderComment(id, data, isReply = false, parentId = null) {
            // √âviter doublons
            if(document.getElementById(`comment-${id}`)) return;

            const dateStr = timeAgo(data.timestamp);
            const userAvatar = data.avatar || `https://ui-avatars.com/api/?name=${data.author}&background=random`;
            
            const div = document.createElement('div');
            div.id = `comment-${id}`;
            div.className = isReply 
                ? "comment-thread mt-3 pt-2 animate-fade-in-up" 
                : "border-b border-white/5 py-6 animate-fade-in-up group";

            // HTML du commentaire
            div.innerHTML = `
                <div class="flex gap-3">
                    <img src="${userAvatar}" class="w-8 h-8 rounded-full border border-white/10 mt-1 object-cover bg-gray-800">
                    <div class="flex-1">
                        <div class="flex items-center gap-2 mb-1">
                            <span class="font-bold text-sm text-white">${data.author}</span>
                            <span class="text-[10px] text-white/40">${dateStr}</span>
                            ${!isReply ? `<span class="bg-white/5 px-1.5 rounded text-[9px] text-white/30">ID:${data.uid.slice(0,3)}</span>` : ''}
                        </div>
                        
                        <p class="text-white/80 text-sm leading-relaxed whitespace-pre-wrap">${data.text}</p>
                        
                        <!-- Actions Bar -->
                        <div class="flex items-center gap-4 mt-3">
                            <button onclick="handleLike('${parentId ? parentId + '/replies/' + id : id}')" class="flex items-center gap-1.5 text-xs text-white/40 hover:text-pink-400 transition-colors group/like">
                                <i class="fa-regular fa-heart group-hover/like:fa-solid"></i>
                                <span class="like-count">${data.likes || 0}</span>
                            </button>
                            
                            ${!isReply ? `
                            <button onclick="toggleReplyForm('${id}')" class="flex items-center gap-1.5 text-xs text-white/40 hover:text-brand-glow transition-colors">
                                <i class="fa-regular fa-comment-dots"></i> R√©pondre
                            </button>` : ''}

                            <button id="btn-delete-${id}" onclick="deleteComment('${parentId ? parentId + '/replies/' + id : id}')" class="hidden flex items-center gap-1.5 text-xs text-white/40 hover:text-red-400 transition-colors ml-auto">
                                <i class="fa-solid fa-trash"></i>
                            </button>
                        </div>

                        <!-- Zone de r√©ponse (cach√©e par d√©faut) -->
                        <div id="reply-form-${id}" class="hidden mt-3 pl-2 border-l-2 border-brand-500/30">
                            <div class="flex gap-2">
                                <input type="text" id="input-reply-${id}" placeholder="R√©pondre √† ${data.author}..." 
                                    class="flex-1 bg-white/5 border border-white/10 rounded-lg px-3 py-1.5 text-xs text-white focus:outline-none focus:border-brand-500">
                                <button onclick="submitReply('${id}')" class="bg-white/10 hover:bg-brand-600 text-white px-3 py-1 rounded-lg text-xs font-bold transition">
                                    <i class="fa-solid fa-paper-plane"></i>
                                </button>
                            </div>
                        </div>

                        <!-- Container pour les r√©ponses -->
                        <div id="replies-${id}" class="flex flex-col"></div>
                    </div>
                </div>
            `;

            if (isReply) {
                document.getElementById(`replies-${parentId}`).appendChild(div);
            } else {
                commentsList.insertBefore(div, commentsList.firstChild);

                if(data.replies) {
                    Object.keys(data.replies).forEach(replyId => {
                        renderComment(replyId, data.replies[replyId], true, id);
                    });
                }
            }

            // Gestion visibilit√© bouton supprimer
            const delBtn = div.querySelector(`#btn-delete-${id}`);
            if (currentUser && data.uid === currentUser.uid) {
                delBtn.classList.remove('hidden');
            }
        }

        // 4. Global Actions
        window.toggleReplyForm = (id) => {
            if (!currentUser) { alert("Connectez-vous pour r√©pondre."); return; }
            const form = document.getElementById(`reply-form-${id}`);
            form.classList.toggle('hidden');
            if(!form.classList.contains('hidden')) {
                setTimeout(() => document.getElementById(`input-reply-${id}`).focus(), 100);
            }
        };

        window.submitReply = (parentId) => {
            const input = document.getElementById(`input-reply-${parentId}`);
            const text = input.value.trim();
            if(!text) return;

            const replyRef = push(ref(db, `comments/${parentId}/replies`));
            set(replyRef, {
                uid: currentUser.uid,
                author: currentUser.displayName || currentUser.email.split('@')[0],
                avatar: currentUser.photoURL || null,
                text: text,
                timestamp: Date.now(),
                likes: 0
            });
            
            // UI Update manuelle pour r√©activit√© imm√©diate
            renderComment(replyRef.key, {
                uid: currentUser.uid,
                author: currentUser.displayName || currentUser.email.split('@')[0],
                avatar: currentUser.photoURL || null,
                text: text,
                timestamp: Date.now(),
                likes: 0
            }, true, parentId);

            input.value = '';
            document.getElementById(`reply-form-${parentId}`).classList.add('hidden');
        };

        window.handleLike = (path) => {
            if (!currentUser) { alert("Connectez-vous pour liker."); return; }
            const likeRef = ref(db, `comments/${path}/likes`);
            runTransaction(likeRef, (currentLikes) => {
                return (currentLikes || 0) + 1;
            });
            const btn = document.activeElement;
            const heart = btn.querySelector('i');
            heart.classList.remove('fa-regular');
            heart.classList.add('fa-solid', 'text-pink-500', 'like-anim');
        };

        window.deleteComment = (path) => {
            if (!confirm("Supprimer ce message ?")) return;
            remove(ref(db, `comments/${path}`))
                .then(() => {
                    if(path.includes('replies')) {
                        const id = path.split('/').pop();
                        document.getElementById(`comment-${id}`).remove();
                    }
                })
                .catch(err => console.error(err));
        };

        // --- SEARCH BAR LOGIC ---
        const searchInput = document.getElementById('app-search');
        const modulesContainer = document.getElementById('modules-container');
        const cards = document.querySelectorAll('.module-card');

        searchInput.addEventListener('input', (e) => {
            const val = e.target.value.toLowerCase();
            if (val.length > 0) modulesContainer.classList.add('search-active');
            else modulesContainer.classList.remove('search-active');

            cards.forEach(card => {
                const keywords = card.getAttribute('data-name');
                if (keywords.includes(val)) card.classList.add('match');
                else card.classList.remove('match');
            });
        });

        // --- AURORA ANIMATION ---
        const canvas = document.getElementById('aurora-bg');
        const ctx = canvas.getContext('2d');
        let width, height;
        const orbs = [
            { x: 0.2, y: 0.2, r: 0.4, color: 'rgba(79, 70, 229, 0.15)', vx: 0.0005, vy: 0.0005 },
            { x: 0.8, y: 0.3, r: 0.5, color: 'rgba(168, 85, 247, 0.15)', vx: -0.0006, vy: 0.0004 }
        ];
        function resize() { width = canvas.width = window.innerWidth; height = canvas.height = window.innerHeight; }
        function animate() {
            ctx.clearRect(0, 0, width, height);
            ctx.fillStyle = '#050505'; ctx.fillRect(0, 0, width, height);
            orbs.forEach(orb => {
                orb.x += orb.vx; orb.y += orb.vy;
                if(orb.x < -0.2 || orb.x > 1.2) orb.vx *= -1;
                if(orb.y < -0.2 || orb.y > 1.2) orb.vy *= -1;
                const g = ctx.createRadialGradient(orb.x * width, orb.y * height, 0, orb.x * width, orb.y * height, orb.r * width);
                g.addColorStop(0, orb.color); g.addColorStop(1, 'rgba(0,0,0,0)');
                ctx.fillStyle = g; ctx.fillRect(0, 0, width, height);
            });
            requestAnimationFrame(animate);
        }
        window.addEventListener('resize', resize); resize(); animate();

    </script>
</body>
</html>
